## Optical Flow

https://blog.csdn.net/qq_41368247/article/details/82562165

总的来说，光流法是利用图像序列中像素在时间域上的变化以及相邻帧之间的相关性来找到上一帧跟当前帧之间存在的对应关系，从而计算出相邻帧之间物体的运动信息的一种方法。

#### 光流的定义：

光流是空间运动在平面上的投影的像素的运动瞬时速度（每个点的光流是一个向量）

#### 光流的物理意义：

参考人类视觉收到二维信息，通过某种灰度像素点的移动速度来获取三维运动信息。所以人类是能够处理光流的。

#### 光流场和研究光流场的目的：

##### 光流场

光流场是一个二维矢量场，描述的是每个像素点的移动方向和大小，理想情况下这是物体运动场的投影

![img](https://img-blog.csdn.net/20180909205649406?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzY4MjQ3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

如上左图的运动场的投影就是右图的光流场。

##### 目的

1. 为了重现运动场。
2. 为了预测将来的像素位置或者是物体位置

就好比人类通过观察一个物体的运动就能预判他未来的运动，这是建立在将光流场还原为运动场的前提下的。



#### 光流法基本原理

##### 基本假设

1. **亮度恒定不变**
2. **时间连续或运动是“小运动”：**前一种情况是理想情况，如果建立出了基于时间的运动函数，那么整个运动轨迹是可以还原出来的（通过偏微分即可）；后一种情况是对大多数图片处理来说，运动是不连续的，得到的信息是相邻的两帧图片，运动是离散化的，也就是运动信息无法真实还原（偏微分无法计算，只能通过差分来近似）

##### 基本约束方程

$$
I(x, y, t)=\mathrm{I}(\mathrm{x}+\mathrm{dx}, \mathrm{y}+\mathrm{dy}, \mathrm{t}+\mathrm{dt})
$$

这是基于第一个假设亮度恒定不变，也就是dt时间内运动（dx，dy）后的位置上值和原来的值相同。
$$
I(x, y, t)=\mathrm{I}(\mathrm{x}, \mathrm{y}, \mathrm{t})+\frac{\partial I}{\partial x} d x+\frac{\partial I}{\partial y} d y+\frac{\partial I}{\partial t} d t+\varepsilon
$$
右侧泰勒展开即可，这一步的具体意义就是通过当前的位置的图像随位置和时间的变化率近似表示移动后的像素点的值，又通过第一个假设知道移动后移动前值相同，这样就能建立图像随时间和空间变化率之间的关系。
$$
\frac{\partial I}{\partial x} \frac{d x}{d t}+\frac{\partial I}{\partial y} \frac{d y}{d t}+\frac{\partial I}{\partial t} \frac{d t}{d t}=0
\\
\mathrm{u}=\frac{d x}{d t}, v=\frac{d y}{d t}
\\
I_{x} u+I_{y} v+I_{t}=0
$$
通过两边对t求偏导引出u和v，达到了目的，建立了第一个光流场的约束关系，（u，v）就是光流场定义中像素点的运动速率。这个约束关系使用单张图像中x方向和y方向的变化率和图片上灰度随时间变化的速率求得的，这些速率都能够直接计算。

在已知一个约束关系后，由于存在u，v两个未知量，所以还需要多一个约束关系。按这个约束关系的类型又分成：

基于梯度（微分）的方法、基于匹配的方法、基于能量（频率）的方法、基于相位的方法和神经动力学方法。

